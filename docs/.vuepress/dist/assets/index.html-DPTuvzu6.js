import{_ as i,c as e,a,o as n}from"./app-CpFzMANX.js";const t={};function l(d,s){return n(),e("div",null,s[0]||(s[0]=[a(`<h1 id="计划任务" tabindex="-1"><a class="header-anchor" href="#计划任务"><span>计划任务</span></a></h1><p>在windows系统中，我们可以通过任务计划程序来实现定时或者事件触发运行事务</p><h1 id="计划任务的创建" tabindex="-1"><a class="header-anchor" href="#计划任务的创建"><span>计划任务的创建</span></a></h1><p>windows中谁创建的计划任务谁能看到，A创建的计划任务默认B是看不到的</p><p>创建任务的命令行是 schtasks /create,后面再加上其它参数，比较常用的参数如下：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /sc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   计划任务类型，可选值为MINUTE、HOURLY、DAILY、WEEKLY、ONCE、ONSTART、ONLOGON、ONIDLE、MONTHLY、ONEVENT</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /tn</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   计划任务名称，后续查询、修改、删除、执行时使用</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /tr</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   需要运行的程序或命令，传入的命令中间如果有空格会被截断为程序和参数，因此需要将双引号转义并传入。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /ru</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   运行任务的用户账户名，不使用此参数的话使用执行schtasks命令的账户运行计划任务</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /rp</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   运行任务的用户账户密码</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /mo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   指定任务在计划类型中的运行间隔</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    指定任务在一个月或者星期的某一天运行，只适用于MONTHLY和WEEKLY类型。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /m</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    指定任务在某个月运行，只适用于MONTHLY类型。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /i</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    当计划任务类型为ONIDLE时，运行任务前计算机处于空闲状态的分钟数。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    st</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    当计划任务类型为MINUTE、HOURLY、DAILY、WEEKLY、MONTHLY时使用，指定任务的开始时间，默认为本地计算机的当前时间。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /ri</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   指定计划任务的重复间隔，以分钟为单位。不适合计划类型：MINUTE、HOURLY、ONSTART、ONLOGON、ONIDLE</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /et</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   指定计划任务的结束时间，适用于计划类型：MINUTE、HOURLY，</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 在指定的结束时间之后，schtasks</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 不会再次启动任务，除非当前系统时间调回开始时间。默认情况下，没有结束时间。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /du</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   指定任务计划的持续时间，与/et类似，默认情况下没有持续时间。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /k</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    在指定计划任务的结束时间或持续时间后停止任务，如果不加此参数，则在时间到了会继续运行或者重启该任务。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   只在用户登录时运行</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /z</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    在任务计划完成后删除任务计划</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    在创建任务时如果任务已存在不显示警告</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /RL</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   为作业设置运行级别。有效值为LIMITED</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 和</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> HIGHEST。默认值为</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LIMITED。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    /F</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    如果指定的任务已经存在，则强制创建任务并抑制警告。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当使用了/sc参数为MINUTE,HOURLY,DAILY,WEEKLY时，我们需要指定/mo运行的间隔时间</p><ul><li>MINUTE: 1到1439分钟</li><li>HOURLY: 1-23小时</li><li>DAILY: 1-365天</li><li>WEEKLY: 1-52周</li><li>ONCE: 无修改者</li><li>ONSTART: 无修改者</li><li>ONLOGON: 无修改者</li><li>ONIDLE: 无修改者</li><li>MONTHLY: 1-12或</li><li>FIRST,SECOND,THIRD,FOURTH,LAST,LASTDAY</li><li>ONEVENT: XPath事件查询字符串</li></ul><p>在windows7上执行schtasks /query显示错误，无法加载列资源，解决办法</p><div class="language-bat line-numbers-mode" data-ext="bat" data-title="bat"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>    chcp437</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="示例" tabindex="-1"><a class="header-anchor" href="#示例"><span>示例</span></a></h1><h2 id="创建计划任务" tabindex="-1"><a class="header-anchor" href="#创建计划任务"><span>创建计划任务</span></a></h2><p>创建名字为test的计划任务，每隔一分钟运行一次，任务执行时指定执行的程序为calc.exe</p><p>重启后也会执行(程序启动的默认权限为当前用户)</p><div class="language-bat line-numbers-mode" data-ext="bat" data-title="bat"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>    schtasks /create /sc minute /mo 1 /tn test /tr C:\\WINDOWS\\system32\\calc.exe</span></span>
<span class="line"><span>    #以system权限运行</span></span>
<span class="line"><span>    schtasks /create /sc minute /mo 1 /tn test /tr C:\\WINDOWS\\system32\\calc.exe /ru system</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="开机上线" tabindex="-1"><a class="header-anchor" href="#开机上线"><span>开机上线</span></a></h2><ol><li>系统启动时上线，无需登录，系统启动时运行poc.exe,但只当指定了运行账好为system时才成功上线：</li></ol><div class="language-bat line-numbers-mode" data-ext="bat" data-title="bat"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>    schtasks /create /tn test /tr C:\\Users\\Administrator\\Desktop\\poc.exe /sc onstart /ru 不运行（计划任务显示准备就绪）</span></span>
<span class="line"><span>    schtasks /create /tn test /tr C:\\Users\\Administrator\\Desktop\\poc.exe /sc onstart /ru administrator  不运行（计划任务显示准备就绪）</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="账号登录时上线" tabindex="-1"><a class="header-anchor" href="#账号登录时上线"><span>账号登录时上线</span></a></h2><div class="language-bat line-numbers-mode" data-ext="bat" data-title="bat"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>    schtasks /create /tn test /tr C:\\Users\\Administrator\\Desktop\\poc.exe /sc onlogon   如添加计划任务时使用的账号，登录成功后即上线</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="应用案例" tabindex="-1"><a class="header-anchor" href="#应用案例"><span>应用案例</span></a></h2><p>创建计划任务‘updatex’,触发程序为poc.exe,运行级别为高级别，以system权限每隔4小时运行一次</p><div class="language-bat line-numbers-mode" data-ext="bat" data-title="bat"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>    schtasks /create /tn &quot;updatex&quot; /tr C:\\Users\\Administrator\\Desktop\\poc.exe /rl highest /F /sc hourly /mo 4 /RU system</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果当前为普通用户执行计划任务，/ru参数值可以设置为 %username% 即当前用户，如果是管理员可以指定为system</p><h1 id="查看计划任务" tabindex="-1"><a class="header-anchor" href="#查看计划任务"><span>查看计划任务</span></a></h1><p>查询计划任务的命令是 schtasks /query, 常用参数如下：</p><ul><li>/fo 指定格式输出，可选Table,List,或者CSV,没加此参数默认是table</li><li>/v 显示详细信息，如任务执行的程序位置等</li></ul><ol><li>查询名称为test的计划任务</li></ol><div class="language-bat line-numbers-mode" data-ext="bat" data-title="bat"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>    schtasks /query | findstr test</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="删除计划任务" tabindex="-1"><a class="header-anchor" href="#删除计划任务"><span>删除计划任务</span></a></h1><p>删除计划任务的命令是schtasks /delete, 计划任务已运行的程序不会中断</p><div class="language-bat line-numbers-mode" data-ext="bat" data-title="bat"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span></span></span>
<span class="line"><span>    schtasks /delete /tn test /f</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="结束计划任务" tabindex="-1"><a class="header-anchor" href="#结束计划任务"><span>结束计划任务</span></a></h1><p>该命令会结束此次运行的计划任务，即将计划任务执行的程序停止，但是到下一次任务执行的时间依然会执行任务，因为没有删除任务</p><div class="language-bat line-numbers-mode" data-ext="bat" data-title="bat"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span></span></span>
<span class="line"><span>    schtasks /end /tn test</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="运行计划任务" tabindex="-1"><a class="header-anchor" href="#运行计划任务"><span>运行计划任务</span></a></h1><p>可以立即运行test计划任务，但是不会影响计划，也不会改变设置的下一个运行时间</p><div class="language-bat line-numbers-mode" data-ext="bat" data-title="bat"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span></span></span>
<span class="line"><span>    schtasks /run /tn test</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div>`,38)]))}const r=i(t,[["render",l],["__file","index.html.vue"]]),c=JSON.parse('{"path":"/notes/Windows/%E5%88%9B%E5%BB%BA%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/","title":"创建计划任务","lang":"zh-CN","frontmatter":{"title":"创建计划任务","aliases":null,"tags":["Windows"],"description":"创建计划任务","createTime":"2024/11/30 14:15:41","draft":false,"head":[["meta",{"property":"og:url","content":"https://kylinBachelor.github.io/notes/Windows/%E5%88%9B%E5%BB%BA%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/"}],["meta",{"property":"og:site_name","content":"攻城狮"}],["meta",{"property":"og:title","content":"创建计划任务"}],["meta",{"property":"og:description","content":"创建计划任务"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-11-30T10:36:56.000Z"}],["meta",{"property":"article:tag","content":"Windows"}],["meta",{"property":"article:modified_time","content":"2024-11-30T10:36:56.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"创建计划任务\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-11-30T10:36:56.000Z\\",\\"author\\":[]}"]]},"headers":[],"readingTime":{"minutes":4.42,"words":1327},"git":{"updatedTime":1732963016000},"filePathRelative":"notes/Windows/创建计划任务/index.md","categoryList":[{"id":"4358b5","sort":10025,"name":"notes"},{"id":"fac604","sort":10029,"name":"Windows"},{"id":"394c32","sort":10131,"name":"创建计划任务"}],"bulletin":false}');export{r as comp,c as data};
