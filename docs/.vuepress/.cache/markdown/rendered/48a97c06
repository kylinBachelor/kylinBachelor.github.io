{"content":"<h1 id=\"一、思路\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#一、思路\"><span>一、思路</span></a></h1>\n<ul>\n<li>生产者发送100个消息</li>\n<li>对照两种情况：\n<ul>\n<li>消费端没有设置prefetch参数：100个消息被全部取回</li>\n<li>消费端设置prefetch参数为1：100个消息慢慢取回</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"二、生产者端代码\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#二、生产者端代码\"><span>二、生产者端代码</span></a></h1>\n<div class=\"language-java line-numbers-mode\" data-ext=\"java\" data-title=\"java\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">@</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">Test</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> testSendMessage</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 100</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        rabbitTemplate</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">convertAndSend</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                EXCHANGE_DIRECT</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                ROUTING_KEY</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Hello atguigu</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h1 id=\"三、消费者端代码\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#三、消费者端代码\"><span>三、消费者端代码</span></a></h1>\n<div class=\"language-java line-numbers-mode\" data-ext=\"java\" data-title=\"java\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 2、正常业务操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">log</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">info</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">消费端接收到消息内容：</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> dataString</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// System.out.println(10 / 0);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">TimeUnit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">SECONDS</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sleep</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 3、给 RabbitMQ 服务器返回 ACK 确认信息</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">channel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">basicAck</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deliveryTag</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> false</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h1 id=\"四、测试\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#四、测试\"><span>四、测试</span></a></h1>\n<h2 id=\"_1、未使用prefetch\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1、未使用prefetch\"><span>1、未使用prefetch</span></a></h2>\n<ul>\n<li>不要启动消费端程序，如果正在运行就把它停了</li>\n<li>运行生产者端程序发送100条消息</li>\n<li>查看队列中消息的情况：</li>\n</ul>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107155915253.png\" alt=\"image-20231107155915253\"></p>\n<ul>\n<li>\n<p>说明：</p>\n<ul>\n<li>Ready表示已经发送到队列的消息数量</li>\n<li>Unacked表示已经发送到消费端但是消费端尚未返回ACK信息的消息数量</li>\n<li>Total未被删除的消息总数</li>\n</ul>\n</li>\n<li>\n<p>接下来启动消费端程序，再查看队列情况：</p>\n</li>\n</ul>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107160233539.png\" alt=\"image-20231107160233539\"></p>\n<ul>\n<li>能看到消息全部被消费端取走了，正在逐个处理、确认，说明有多少消息消费端就并发处理多少</li>\n</ul>\n<h2 id=\"_2、设定prefetch\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2、设定prefetch\"><span>2、设定prefetch</span></a></h2>\n<h3 id=\"_1yaml配置\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1yaml配置\"><span>①YAML配置</span></a></h3>\n<div class=\"language-yaml line-numbers-mode\" data-ext=\"yaml\" data-title=\"yaml\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">spring</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">  rabbitmq</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    host</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 192.168.200.100</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 5672</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    username</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> guest</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    password</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 123456</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    virtual-host</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    listener</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">      simple</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        acknowledge-mode</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> manual</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        prefetch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 设置每次最多从消息队列服务器取回多少消息</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_2测试流程\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2测试流程\"><span>②测试流程</span></a></h3>\n<ul>\n<li>停止消费端程序</li>\n<li>运行生产者端程序发送100条消息</li>\n<li>查看队列中消息的情况：</li>\n</ul>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107160820062.png\" alt=\"image-20231107160820062\"></p>\n<ul>\n<li>接下来启动消费端程序，持续观察队列情况：</li>\n</ul>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107160922632.png\" alt=\"image-20231107160922632\"></p>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107160936216.png\" alt=\"image-20231107160936216\"></p>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107160951639.png\" alt=\"image-20231107160951639\"></p>\n<ul>\n<li>能看到消息不是一次性全部取回的，而是有个过程</li>\n</ul>\n","env":{"base":"/","filePath":"C:/Users/kylinBachelor/Desktop/my-project/docs/notes/MQ/RabbitMQ/Operation009-Prefetch.md","filePathRelative":"notes/MQ/RabbitMQ/Operation009-Prefetch.md","frontmatter":{"title":"12.Prefetch","aliases":null,"tags":["RabbitMQ MQ"],"description":"RabbitMQ","createTime":"2024/11/30 14:15:41","draft":false,"permalink":"/article/mvzet8c0/"},"sfcBlocks":{"template":{"type":"template","content":"<template><h1 id=\"一、思路\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#一、思路\"><span>一、思路</span></a></h1>\n<ul>\n<li>生产者发送100个消息</li>\n<li>对照两种情况：\n<ul>\n<li>消费端没有设置prefetch参数：100个消息被全部取回</li>\n<li>消费端设置prefetch参数为1：100个消息慢慢取回</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"二、生产者端代码\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#二、生产者端代码\"><span>二、生产者端代码</span></a></h1>\n<div class=\"language-java line-numbers-mode\" data-ext=\"java\" data-title=\"java\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">@</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">Test</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> testSendMessage</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 100</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        rabbitTemplate</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">convertAndSend</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                EXCHANGE_DIRECT</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                ROUTING_KEY</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Hello atguigu</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h1 id=\"三、消费者端代码\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#三、消费者端代码\"><span>三、消费者端代码</span></a></h1>\n<div class=\"language-java line-numbers-mode\" data-ext=\"java\" data-title=\"java\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 2、正常业务操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">log</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">info</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">消费端接收到消息内容：</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> dataString</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// System.out.println(10 / 0);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">TimeUnit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">SECONDS</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sleep</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 3、给 RabbitMQ 服务器返回 ACK 确认信息</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">channel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">basicAck</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deliveryTag</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> false</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h1 id=\"四、测试\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#四、测试\"><span>四、测试</span></a></h1>\n<h2 id=\"_1、未使用prefetch\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1、未使用prefetch\"><span>1、未使用prefetch</span></a></h2>\n<ul>\n<li>不要启动消费端程序，如果正在运行就把它停了</li>\n<li>运行生产者端程序发送100条消息</li>\n<li>查看队列中消息的情况：</li>\n</ul>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107155915253.png\" alt=\"image-20231107155915253\"></p>\n<ul>\n<li>\n<p>说明：</p>\n<ul>\n<li>Ready表示已经发送到队列的消息数量</li>\n<li>Unacked表示已经发送到消费端但是消费端尚未返回ACK信息的消息数量</li>\n<li>Total未被删除的消息总数</li>\n</ul>\n</li>\n<li>\n<p>接下来启动消费端程序，再查看队列情况：</p>\n</li>\n</ul>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107160233539.png\" alt=\"image-20231107160233539\"></p>\n<ul>\n<li>能看到消息全部被消费端取走了，正在逐个处理、确认，说明有多少消息消费端就并发处理多少</li>\n</ul>\n<h2 id=\"_2、设定prefetch\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2、设定prefetch\"><span>2、设定prefetch</span></a></h2>\n<h3 id=\"_1yaml配置\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1yaml配置\"><span>①YAML配置</span></a></h3>\n<div class=\"language-yaml line-numbers-mode\" data-ext=\"yaml\" data-title=\"yaml\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">spring</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">  rabbitmq</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    host</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 192.168.200.100</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 5672</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    username</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> guest</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    password</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 123456</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    virtual-host</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    listener</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">      simple</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        acknowledge-mode</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> manual</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        prefetch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 设置每次最多从消息队列服务器取回多少消息</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_2测试流程\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2测试流程\"><span>②测试流程</span></a></h3>\n<ul>\n<li>停止消费端程序</li>\n<li>运行生产者端程序发送100条消息</li>\n<li>查看队列中消息的情况：</li>\n</ul>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107160820062.png\" alt=\"image-20231107160820062\"></p>\n<ul>\n<li>接下来启动消费端程序，持续观察队列情况：</li>\n</ul>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107160922632.png\" alt=\"image-20231107160922632\"></p>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107160936216.png\" alt=\"image-20231107160936216\"></p>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107160951639.png\" alt=\"image-20231107160951639\"></p>\n<ul>\n<li>能看到消息不是一次性全部取回的，而是有个过程</li>\n</ul>\n</template>","contentStripped":"<h1 id=\"一、思路\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#一、思路\"><span>一、思路</span></a></h1>\n<ul>\n<li>生产者发送100个消息</li>\n<li>对照两种情况：\n<ul>\n<li>消费端没有设置prefetch参数：100个消息被全部取回</li>\n<li>消费端设置prefetch参数为1：100个消息慢慢取回</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"二、生产者端代码\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#二、生产者端代码\"><span>二、生产者端代码</span></a></h1>\n<div class=\"language-java line-numbers-mode\" data-ext=\"java\" data-title=\"java\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">@</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">Test</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> testSendMessage</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 100</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        rabbitTemplate</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">convertAndSend</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                EXCHANGE_DIRECT</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                ROUTING_KEY</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Hello atguigu</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h1 id=\"三、消费者端代码\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#三、消费者端代码\"><span>三、消费者端代码</span></a></h1>\n<div class=\"language-java line-numbers-mode\" data-ext=\"java\" data-title=\"java\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 2、正常业务操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">log</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">info</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">消费端接收到消息内容：</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> dataString</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// System.out.println(10 / 0);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">TimeUnit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">SECONDS</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sleep</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 3、给 RabbitMQ 服务器返回 ACK 确认信息</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">channel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">basicAck</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deliveryTag</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> false</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h1 id=\"四、测试\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#四、测试\"><span>四、测试</span></a></h1>\n<h2 id=\"_1、未使用prefetch\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1、未使用prefetch\"><span>1、未使用prefetch</span></a></h2>\n<ul>\n<li>不要启动消费端程序，如果正在运行就把它停了</li>\n<li>运行生产者端程序发送100条消息</li>\n<li>查看队列中消息的情况：</li>\n</ul>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107155915253.png\" alt=\"image-20231107155915253\"></p>\n<ul>\n<li>\n<p>说明：</p>\n<ul>\n<li>Ready表示已经发送到队列的消息数量</li>\n<li>Unacked表示已经发送到消费端但是消费端尚未返回ACK信息的消息数量</li>\n<li>Total未被删除的消息总数</li>\n</ul>\n</li>\n<li>\n<p>接下来启动消费端程序，再查看队列情况：</p>\n</li>\n</ul>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107160233539.png\" alt=\"image-20231107160233539\"></p>\n<ul>\n<li>能看到消息全部被消费端取走了，正在逐个处理、确认，说明有多少消息消费端就并发处理多少</li>\n</ul>\n<h2 id=\"_2、设定prefetch\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2、设定prefetch\"><span>2、设定prefetch</span></a></h2>\n<h3 id=\"_1yaml配置\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1yaml配置\"><span>①YAML配置</span></a></h3>\n<div class=\"language-yaml line-numbers-mode\" data-ext=\"yaml\" data-title=\"yaml\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">spring</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">  rabbitmq</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    host</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 192.168.200.100</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 5672</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    username</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> guest</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    password</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 123456</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    virtual-host</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    listener</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">      simple</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        acknowledge-mode</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> manual</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        prefetch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 设置每次最多从消息队列服务器取回多少消息</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_2测试流程\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2测试流程\"><span>②测试流程</span></a></h3>\n<ul>\n<li>停止消费端程序</li>\n<li>运行生产者端程序发送100条消息</li>\n<li>查看队列中消息的情况：</li>\n</ul>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107160820062.png\" alt=\"image-20231107160820062\"></p>\n<ul>\n<li>接下来启动消费端程序，持续观察队列情况：</li>\n</ul>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107160922632.png\" alt=\"image-20231107160922632\"></p>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107160936216.png\" alt=\"image-20231107160936216\"></p>\n<p><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231107160951639.png\" alt=\"image-20231107160951639\"></p>\n<ul>\n<li>能看到消息不是一次性全部取回的，而是有个过程</li>\n</ul>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"# 一、思路\r\n\r\n- 生产者发送100个消息\r\n- 对照两种情况：\r\n  - 消费端没有设置prefetch参数：100个消息被全部取回\r\n  - 消费端设置prefetch参数为1：100个消息慢慢取回\r\n\r\n\r\n\r\n# 二、生产者端代码\r\n\r\n```java\r\n@Test  \r\npublic void testSendMessage() {\r\n    for (int i = 0; i < 100; i++) {\r\n        rabbitTemplate.convertAndSend(\r\n                EXCHANGE_DIRECT,\r\n                ROUTING_KEY,\r\n                \"Hello atguigu\" + i);\r\n    }\r\n}\r\n```\r\n\r\n\r\n\r\n# 三、消费者端代码\r\n\r\n```java\r\n// 2、正常业务操作\r\nlog.info(\"消费端接收到消息内容：\" + dataString);\r\n\r\n// System.out.println(10 / 0);\r\nTimeUnit.SECONDS.sleep(1);\r\n\r\n// 3、给 RabbitMQ 服务器返回 ACK 确认信息\r\nchannel.basicAck(deliveryTag, false);\r\n```\r\n\r\n\r\n\r\n# 四、测试\r\n\r\n## 1、未使用prefetch\r\n\r\n- 不要启动消费端程序，如果正在运行就把它停了\r\n- 运行生产者端程序发送100条消息\r\n- 查看队列中消息的情况：\r\n\r\n![image-20231107155915253](./assets/image-20231107155915253.png)\r\n\r\n- 说明：\r\n  - Ready表示已经发送到队列的消息数量\r\n  - Unacked表示已经发送到消费端但是消费端尚未返回ACK信息的消息数量\r\n  - Total未被删除的消息总数\r\n\r\n- 接下来启动消费端程序，再查看队列情况：\r\n\r\n![image-20231107160233539](./assets/image-20231107160233539.png)\r\n\r\n- 能看到消息全部被消费端取走了，正在逐个处理、确认，说明有多少消息消费端就并发处理多少\r\n\r\n\r\n\r\n## 2、设定prefetch\r\n\r\n### ①YAML配置\r\n\r\n```yaml\r\nspring:\r\n  rabbitmq:\r\n    host: 192.168.200.100\r\n    port: 5672\r\n    username: guest\r\n    password: 123456\r\n    virtual-host: /\r\n    listener:\r\n      simple:\r\n        acknowledge-mode: manual\r\n        prefetch: 1 # 设置每次最多从消息队列服务器取回多少消息\r\n```\r\n\r\n\r\n\r\n### ②测试流程\r\n\r\n- 停止消费端程序\r\n- 运行生产者端程序发送100条消息\r\n- 查看队列中消息的情况：\r\n\r\n![image-20231107160820062](./assets/image-20231107160820062.png)\r\n\r\n- 接下来启动消费端程序，持续观察队列情况：\r\n\r\n![image-20231107160922632](./assets/image-20231107160922632.png)\r\n\r\n\r\n\r\n![image-20231107160936216](./assets/image-20231107160936216.png)\r\n\r\n\r\n\r\n![image-20231107160951639](./assets/image-20231107160951639.png)\r\n\r\n\r\n\r\n- 能看到消息不是一次性全部取回的，而是有个过程","excerpt":"","includedFiles":[],"tasklists":0,"title":"一、思路","headers":[{"level":2,"title":"1、未使用prefetch","slug":"_1、未使用prefetch","link":"#_1、未使用prefetch","children":[]},{"level":2,"title":"2、设定prefetch","slug":"_2、设定prefetch","link":"#_2、设定prefetch","children":[{"level":3,"title":"①YAML配置","slug":"_1yaml配置","link":"#_1yaml配置","children":[]},{"level":3,"title":"②测试流程","slug":"_2测试流程","link":"#_2测试流程","children":[]}]}]}}
