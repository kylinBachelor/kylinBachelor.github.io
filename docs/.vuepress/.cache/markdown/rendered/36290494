{"content":"<p>仲裁队列通过 Raft 协议，实现了不同节点间队列消息数据的复制，使得在 创建这个队列的节点 宕机时，其他节点仍然可以使用该队列进行服务.</p>\n<blockquote>\n<p><span style=\"color:blue;font-weight:bolder;\">说明</span>：鉴于仲裁队列的功能，肯定是需要在前面集群的基础上操作！</p>\n</blockquote>\n<h2 id=\"_1、创建交换机\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1、创建交换机\"><span>1、创建交换机</span></a></h2>\n<p>和仲裁队列绑定的交换机没有特殊，我们还是创建一个direct交换机即可</p>\n<p>交换机名称：exchange.quorum.test</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206164511238.png\" alt=\"image-20231206164511238\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206164511238</figcaption></figure>\n<h2 id=\"_2、创建仲裁队列\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2、创建仲裁队列\"><span>2、创建仲裁队列</span></a></h2>\n<p>队列名称：queue.quorum.test</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206164838398.png\" alt=\"image-20231206164838398\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206164838398</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206165113573.png\" alt=\"image-20231206165113573\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206165113573</figcaption></figure>\n<h2 id=\"_3、绑定交换机\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3、绑定交换机\"><span>3、绑定交换机</span></a></h2>\n<p>路由键：routing.key.quorum.test</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206164951831.png\" alt=\"image-20231206164951831\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206164951831</figcaption></figure>\n<h1 id=\"二、测试仲裁队列\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#二、测试仲裁队列\"><span>二、测试仲裁队列</span></a></h1>\n<h2 id=\"_1、常规测试\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1、常规测试\"><span>1、常规测试</span></a></h2>\n<p>像使用经典队列一样发送消息、消费消息</p>\n<h3 id=\"_1生产者端\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1生产者端\"><span>①生产者端</span></a></h3>\n<div class=\"language-java line-numbers-mode\" data-ext=\"java\" data-title=\"java\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> final</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> String</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> EXCHANGE_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exchange.quorum.test</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> final</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> String</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> ROUTING_KEY_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">routing.key.quorum.test</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">@</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">Test</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> testSendMessageToQuorum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    rabbitTemplate</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">convertAndSend</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">EXCHANGE_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ROUTING_KEY_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">message test quorum ~~~</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206170401658.png\" alt=\"image-20231206170401658\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206170401658</figcaption></figure>\n<h3 id=\"_2消费者端\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2消费者端\"><span>②消费者端</span></a></h3>\n<div class=\"language-java line-numbers-mode\" data-ext=\"java\" data-title=\"java\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> final</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> String</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> QUEUE_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">queue.quorum.test</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">@</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">RabbitListener</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">queues</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">QUEUE_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">})</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> quorumMessageProcess</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">String data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Message message</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Channel channel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> throws IOException </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    log</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">info</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">消费端：</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    channel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">basicAck</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">getMessageProperties</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">getDeliveryTag</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(),</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> false</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206170424609.png\" alt=\"image-20231206170424609\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206170424609</figcaption></figure>\n<h2 id=\"_2、高可用测试\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2、高可用测试\"><span>2、高可用测试</span></a></h2>\n<h3 id=\"_1停止某个节点的rabbit应用\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1停止某个节点的rabbit应用\"><span>①停止某个节点的rabbit应用</span></a></h3>\n<div class=\"language-shell line-numbers-mode\" data-ext=\"shell\" data-title=\"shell\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 停止rabbit应用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">rabbitmqctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> stop_app</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_2查看仲裁队列对应的节点情况\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2查看仲裁队列对应的节点情况\"><span>②查看仲裁队列对应的节点情况</span></a></h3>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206170906222.png\" alt=\"image-20231206170906222\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206170906222</figcaption></figure>\n<h3 id=\"_3再次发送消息\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3再次发送消息\"><span>③再次发送消息</span></a></h3>\n<p>收发消息仍然正常</p>\n","env":{"base":"/","filePath":"C:/Users/kylinBachelor/Desktop/kylinBachelor.github.io/docs/notes/MQ/RabbitMQ/仲裁队列.md","filePathRelative":"notes/MQ/RabbitMQ/仲裁队列.md","frontmatter":{"title":"仲裁队列","createTime":"2024/12/01 14:15:28"},"sfcBlocks":{"template":{"type":"template","content":"<template><p>仲裁队列通过 Raft 协议，实现了不同节点间队列消息数据的复制，使得在 创建这个队列的节点 宕机时，其他节点仍然可以使用该队列进行服务.</p>\n<blockquote>\n<p><span style=\"color:blue;font-weight:bolder;\">说明</span>：鉴于仲裁队列的功能，肯定是需要在前面集群的基础上操作！</p>\n</blockquote>\n<h2 id=\"_1、创建交换机\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1、创建交换机\"><span>1、创建交换机</span></a></h2>\n<p>和仲裁队列绑定的交换机没有特殊，我们还是创建一个direct交换机即可</p>\n<p>交换机名称：exchange.quorum.test</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206164511238.png\" alt=\"image-20231206164511238\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206164511238</figcaption></figure>\n<h2 id=\"_2、创建仲裁队列\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2、创建仲裁队列\"><span>2、创建仲裁队列</span></a></h2>\n<p>队列名称：queue.quorum.test</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206164838398.png\" alt=\"image-20231206164838398\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206164838398</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206165113573.png\" alt=\"image-20231206165113573\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206165113573</figcaption></figure>\n<h2 id=\"_3、绑定交换机\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3、绑定交换机\"><span>3、绑定交换机</span></a></h2>\n<p>路由键：routing.key.quorum.test</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206164951831.png\" alt=\"image-20231206164951831\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206164951831</figcaption></figure>\n<h1 id=\"二、测试仲裁队列\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#二、测试仲裁队列\"><span>二、测试仲裁队列</span></a></h1>\n<h2 id=\"_1、常规测试\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1、常规测试\"><span>1、常规测试</span></a></h2>\n<p>像使用经典队列一样发送消息、消费消息</p>\n<h3 id=\"_1生产者端\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1生产者端\"><span>①生产者端</span></a></h3>\n<div class=\"language-java line-numbers-mode\" data-ext=\"java\" data-title=\"java\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> final</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> String</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> EXCHANGE_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exchange.quorum.test</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> final</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> String</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> ROUTING_KEY_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">routing.key.quorum.test</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">@</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">Test</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> testSendMessageToQuorum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    rabbitTemplate</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">convertAndSend</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">EXCHANGE_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ROUTING_KEY_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">message test quorum ~~~</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206170401658.png\" alt=\"image-20231206170401658\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206170401658</figcaption></figure>\n<h3 id=\"_2消费者端\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2消费者端\"><span>②消费者端</span></a></h3>\n<div class=\"language-java line-numbers-mode\" data-ext=\"java\" data-title=\"java\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> final</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> String</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> QUEUE_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">queue.quorum.test</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">@</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">RabbitListener</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">queues</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">QUEUE_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">})</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> quorumMessageProcess</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">String data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Message message</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Channel channel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> throws IOException </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    log</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">info</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">消费端：</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    channel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">basicAck</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">getMessageProperties</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">getDeliveryTag</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(),</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> false</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206170424609.png\" alt=\"image-20231206170424609\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206170424609</figcaption></figure>\n<h2 id=\"_2、高可用测试\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2、高可用测试\"><span>2、高可用测试</span></a></h2>\n<h3 id=\"_1停止某个节点的rabbit应用\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1停止某个节点的rabbit应用\"><span>①停止某个节点的rabbit应用</span></a></h3>\n<div class=\"language-shell line-numbers-mode\" data-ext=\"shell\" data-title=\"shell\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 停止rabbit应用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">rabbitmqctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> stop_app</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_2查看仲裁队列对应的节点情况\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2查看仲裁队列对应的节点情况\"><span>②查看仲裁队列对应的节点情况</span></a></h3>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206170906222.png\" alt=\"image-20231206170906222\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206170906222</figcaption></figure>\n<h3 id=\"_3再次发送消息\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3再次发送消息\"><span>③再次发送消息</span></a></h3>\n<p>收发消息仍然正常</p>\n</template>","contentStripped":"<p>仲裁队列通过 Raft 协议，实现了不同节点间队列消息数据的复制，使得在 创建这个队列的节点 宕机时，其他节点仍然可以使用该队列进行服务.</p>\n<blockquote>\n<p><span style=\"color:blue;font-weight:bolder;\">说明</span>：鉴于仲裁队列的功能，肯定是需要在前面集群的基础上操作！</p>\n</blockquote>\n<h2 id=\"_1、创建交换机\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1、创建交换机\"><span>1、创建交换机</span></a></h2>\n<p>和仲裁队列绑定的交换机没有特殊，我们还是创建一个direct交换机即可</p>\n<p>交换机名称：exchange.quorum.test</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206164511238.png\" alt=\"image-20231206164511238\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206164511238</figcaption></figure>\n<h2 id=\"_2、创建仲裁队列\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2、创建仲裁队列\"><span>2、创建仲裁队列</span></a></h2>\n<p>队列名称：queue.quorum.test</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206164838398.png\" alt=\"image-20231206164838398\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206164838398</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206165113573.png\" alt=\"image-20231206165113573\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206165113573</figcaption></figure>\n<h2 id=\"_3、绑定交换机\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3、绑定交换机\"><span>3、绑定交换机</span></a></h2>\n<p>路由键：routing.key.quorum.test</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206164951831.png\" alt=\"image-20231206164951831\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206164951831</figcaption></figure>\n<h1 id=\"二、测试仲裁队列\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#二、测试仲裁队列\"><span>二、测试仲裁队列</span></a></h1>\n<h2 id=\"_1、常规测试\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1、常规测试\"><span>1、常规测试</span></a></h2>\n<p>像使用经典队列一样发送消息、消费消息</p>\n<h3 id=\"_1生产者端\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1生产者端\"><span>①生产者端</span></a></h3>\n<div class=\"language-java line-numbers-mode\" data-ext=\"java\" data-title=\"java\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> final</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> String</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> EXCHANGE_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exchange.quorum.test</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> final</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> String</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> ROUTING_KEY_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">routing.key.quorum.test</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">@</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">Test</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> testSendMessageToQuorum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    rabbitTemplate</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">convertAndSend</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">EXCHANGE_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ROUTING_KEY_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">message test quorum ~~~</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206170401658.png\" alt=\"image-20231206170401658\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206170401658</figcaption></figure>\n<h3 id=\"_2消费者端\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2消费者端\"><span>②消费者端</span></a></h3>\n<div class=\"language-java line-numbers-mode\" data-ext=\"java\" data-title=\"java\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> final</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> String</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> QUEUE_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">queue.quorum.test</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">@</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">RabbitListener</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">queues</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">QUEUE_QUORUM_TEST</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">})</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> quorumMessageProcess</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">String data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Message message</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Channel channel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> throws IOException </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    log</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">info</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">消费端：</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    channel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">basicAck</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">getMessageProperties</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">getDeliveryTag</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(),</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> false</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206170424609.png\" alt=\"image-20231206170424609\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206170424609</figcaption></figure>\n<h2 id=\"_2、高可用测试\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2、高可用测试\"><span>2、高可用测试</span></a></h2>\n<h3 id=\"_1停止某个节点的rabbit应用\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1停止某个节点的rabbit应用\"><span>①停止某个节点的rabbit应用</span></a></h3>\n<div class=\"language-shell line-numbers-mode\" data-ext=\"shell\" data-title=\"shell\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 停止rabbit应用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">rabbitmqctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> stop_app</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_2查看仲裁队列对应的节点情况\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2查看仲裁队列对应的节点情况\"><span>②查看仲裁队列对应的节点情况</span></a></h3>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231206170906222.png\" alt=\"image-20231206170906222\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231206170906222</figcaption></figure>\n<h3 id=\"_3再次发送消息\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3再次发送消息\"><span>③再次发送消息</span></a></h3>\n<p>收发消息仍然正常</p>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"\n仲裁队列通过 Raft 协议，实现了不同节点间队列消息数据的复制，使得在 创建这个队列的节点 宕机时，其他节点仍然可以使用该队列进行服务.\n\n> <span style=\"color:blue;font-weight:bolder;\">说明</span>：鉴于仲裁队列的功能，肯定是需要在前面集群的基础上操作！\n\n\n\n## 1、创建交换机\n\n和仲裁队列绑定的交换机没有特殊，我们还是创建一个direct交换机即可\n\n交换机名称：exchange.quorum.test\n\n![image-20231206164511238](./assets/image-20231206164511238.png)\n\n\n\n## 2、创建仲裁队列\n\n队列名称：queue.quorum.test\n\n![image-20231206164838398](./assets/image-20231206164838398.png)\n\n\n\n![image-20231206165113573](./assets/image-20231206165113573.png)\n\n\n\n## 3、绑定交换机\n\n路由键：routing.key.quorum.test\n\n![image-20231206164951831](./assets/image-20231206164951831.png)\n\n\n\n# 二、测试仲裁队列\n\n## 1、常规测试\n\n像使用经典队列一样发送消息、消费消息\n\n\n\n### ①生产者端\n\n```java\npublic static final String EXCHANGE_QUORUM_TEST = \"exchange.quorum.test\";\npublic static final String ROUTING_KEY_QUORUM_TEST = \"routing.key.quorum.test\";\n\n@Test\npublic void testSendMessageToQuorum() {\n    rabbitTemplate.convertAndSend(EXCHANGE_QUORUM_TEST, ROUTING_KEY_QUORUM_TEST, \"message test quorum ~~~\");\n}\n```\n\n\n\n![image-20231206170401658](./assets/image-20231206170401658.png)\n\n\n\n### ②消费者端\n\n```java\npublic static final String QUEUE_QUORUM_TEST = \"queue.quorum.test\";\n\n@RabbitListener(queues = {QUEUE_QUORUM_TEST})\npublic void quorumMessageProcess(String data, Message message, Channel channel) throws IOException {\n    log.info(\"消费端：\" + data);\n    channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n}\n```\n\n\n\n![image-20231206170424609](./assets/image-20231206170424609.png)\n\n\n\n## 2、高可用测试\n\n### ①停止某个节点的rabbit应用\n\n```shell\n# 停止rabbit应用\nrabbitmqctl stop_app\n```\n\n\n\n### ②查看仲裁队列对应的节点情况\n\n![image-20231206170906222](./assets/image-20231206170906222.png)\n\n\n\n### ③再次发送消息\n\n收发消息仍然正常","excerpt":"","includedFiles":[],"tasklists":0,"title":"二、测试仲裁队列","headers":[{"level":2,"title":"1、创建交换机","slug":"_1、创建交换机","link":"#_1、创建交换机","children":[]},{"level":2,"title":"2、创建仲裁队列","slug":"_2、创建仲裁队列","link":"#_2、创建仲裁队列","children":[]},{"level":2,"title":"3、绑定交换机","slug":"_3、绑定交换机","link":"#_3、绑定交换机","children":[]},{"level":2,"title":"1、常规测试","slug":"_1、常规测试","link":"#_1、常规测试","children":[{"level":3,"title":"①生产者端","slug":"_1生产者端","link":"#_1生产者端","children":[]},{"level":3,"title":"②消费者端","slug":"_2消费者端","link":"#_2消费者端","children":[]}]},{"level":2,"title":"2、高可用测试","slug":"_2、高可用测试","link":"#_2、高可用测试","children":[{"level":3,"title":"①停止某个节点的rabbit应用","slug":"_1停止某个节点的rabbit应用","link":"#_1停止某个节点的rabbit应用","children":[]},{"level":3,"title":"②查看仲裁队列对应的节点情况","slug":"_2查看仲裁队列对应的节点情况","link":"#_2查看仲裁队列对应的节点情况","children":[]},{"level":3,"title":"③再次发送消息","slug":"_3再次发送消息","link":"#_3再次发送消息","children":[]}]}]}}
