{"content":"<h2 id=\"_1、创建备份交换机\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1、创建备份交换机\"><span>1、创建备份交换机</span></a></h2>\n<p><span style=\"color:blue;font-weight:bolder;\">注意</span>：备份交换机<span style=\"color:blue;font-weight:bolder;\">一定</span>要选择<span style=\"color:blue;font-weight:bolder;\">fanout类型</span>，因为原交换机转入备份交换机时并不会指定路由键</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231203231926247.png\" alt=\"image-20231203231926247\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231203231926247</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202183701454.png\" alt=\"image-20231202183701454\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202183701454</figcaption></figure>\n<h2 id=\"_2、创建备份交换机要绑定的队列\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2、创建备份交换机要绑定的队列\"><span>2、创建备份交换机要绑定的队列</span></a></h2>\n<h3 id=\"_1创建队列\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1创建队列\"><span>①创建队列</span></a></h3>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202183906676.png\" alt=\"image-20231202183906676\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202183906676</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202183949674.png\" alt=\"image-20231202183949674\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202183949674</figcaption></figure>\n<h3 id=\"_2绑定交换机\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2绑定交换机\"><span>②绑定交换机</span></a></h3>\n<p><span style=\"color:blue;font-weight:bolder;\">注意</span>：这里是要和备份交换机绑定</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231203232801504.png\" alt=\"image-20231203232801504\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231203232801504</figcaption></figure>\n<h2 id=\"_3、针对备份队列创建消费端监听器\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3、针对备份队列创建消费端监听器\"><span>3、针对备份队列创建消费端监听器</span></a></h2>\n<div class=\"language-java line-numbers-mode\" data-ext=\"java\" data-title=\"java\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> final</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> String</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> EXCHANGE_DIRECT_BACKUP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exchange.direct.order.backup</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> final</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> String</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> QUEUE_NAME_BACKUP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">queue.order.backup</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    @</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">RabbitListener</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">bindings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> @</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">QueueBinding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">            value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> @</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">Queue</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> QUEUE_NAME_BACKUP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> durable</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">true</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">            exchange</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> @</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">Exchange</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EXCHANGE_DIRECT_BACKUP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">            key</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    ))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> processMessageBackup</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">String dateString</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                                     Message message</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                                     Channel channel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        log</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">info</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">BackUp: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> dateString</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h1 id=\"二、设定备份关系\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#二、设定备份关系\"><span>二、设定备份关系</span></a></h1>\n<h2 id=\"_1、原交换机删除\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1、原交换机删除\"><span>1、原交换机删除</span></a></h2>\n<p>·</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202184840124.png\" alt=\"image-20231202184840124\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202184840124</figcaption></figure>\n<h2 id=\"_2、重新创建原交换机\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2、重新创建原交换机\"><span>2、重新创建原交换机</span></a></h2>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202185211633.png\" alt=\"image-20231202185211633\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202185211633</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202185342087.png\" alt=\"image-20231202185342087\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202185342087</figcaption></figure>\n<h2 id=\"_3、原交换机重新绑定原队列\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3、原交换机重新绑定原队列\"><span>3、原交换机重新绑定原队列</span></a></h2>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202190111581.png\" alt=\"image-20231202190111581\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202190111581</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202185955138.png\" alt=\"image-20231202185955138\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202185955138</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202190036520.png\" alt=\"image-20231202190036520\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202190036520</figcaption></figure>\n<h1 id=\"三、测试\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#三、测试\"><span>三、测试</span></a></h1>\n<ul>\n<li>启动消费者端</li>\n<li>发送消息，但是路由键不对，于是转入备份交换机</li>\n</ul>\n","env":{"base":"/","filePath":"C:/Users/kylinBachelor/Desktop/kylinBachelor.github.io/docs/notes/MQ/RabbitMQ/备份交换机.md","filePathRelative":"notes/MQ/RabbitMQ/备份交换机.md","frontmatter":{"title":"备份交换机","createTime":"2024/12/01 13:47:25"},"sfcBlocks":{"template":{"type":"template","content":"<template><h2 id=\"_1、创建备份交换机\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1、创建备份交换机\"><span>1、创建备份交换机</span></a></h2>\n<p><span style=\"color:blue;font-weight:bolder;\">注意</span>：备份交换机<span style=\"color:blue;font-weight:bolder;\">一定</span>要选择<span style=\"color:blue;font-weight:bolder;\">fanout类型</span>，因为原交换机转入备份交换机时并不会指定路由键</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231203231926247.png\" alt=\"image-20231203231926247\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231203231926247</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202183701454.png\" alt=\"image-20231202183701454\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202183701454</figcaption></figure>\n<h2 id=\"_2、创建备份交换机要绑定的队列\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2、创建备份交换机要绑定的队列\"><span>2、创建备份交换机要绑定的队列</span></a></h2>\n<h3 id=\"_1创建队列\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1创建队列\"><span>①创建队列</span></a></h3>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202183906676.png\" alt=\"image-20231202183906676\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202183906676</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202183949674.png\" alt=\"image-20231202183949674\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202183949674</figcaption></figure>\n<h3 id=\"_2绑定交换机\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2绑定交换机\"><span>②绑定交换机</span></a></h3>\n<p><span style=\"color:blue;font-weight:bolder;\">注意</span>：这里是要和备份交换机绑定</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231203232801504.png\" alt=\"image-20231203232801504\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231203232801504</figcaption></figure>\n<h2 id=\"_3、针对备份队列创建消费端监听器\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3、针对备份队列创建消费端监听器\"><span>3、针对备份队列创建消费端监听器</span></a></h2>\n<div class=\"language-java line-numbers-mode\" data-ext=\"java\" data-title=\"java\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> final</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> String</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> EXCHANGE_DIRECT_BACKUP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exchange.direct.order.backup</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> final</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> String</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> QUEUE_NAME_BACKUP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">queue.order.backup</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    @</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">RabbitListener</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">bindings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> @</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">QueueBinding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">            value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> @</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">Queue</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> QUEUE_NAME_BACKUP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> durable</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">true</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">            exchange</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> @</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">Exchange</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EXCHANGE_DIRECT_BACKUP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">            key</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    ))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> processMessageBackup</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">String dateString</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                                     Message message</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                                     Channel channel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        log</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">info</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">BackUp: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> dateString</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h1 id=\"二、设定备份关系\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#二、设定备份关系\"><span>二、设定备份关系</span></a></h1>\n<h2 id=\"_1、原交换机删除\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1、原交换机删除\"><span>1、原交换机删除</span></a></h2>\n<p>·</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202184840124.png\" alt=\"image-20231202184840124\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202184840124</figcaption></figure>\n<h2 id=\"_2、重新创建原交换机\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2、重新创建原交换机\"><span>2、重新创建原交换机</span></a></h2>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202185211633.png\" alt=\"image-20231202185211633\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202185211633</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202185342087.png\" alt=\"image-20231202185342087\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202185342087</figcaption></figure>\n<h2 id=\"_3、原交换机重新绑定原队列\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3、原交换机重新绑定原队列\"><span>3、原交换机重新绑定原队列</span></a></h2>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202190111581.png\" alt=\"image-20231202190111581\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202190111581</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202185955138.png\" alt=\"image-20231202185955138\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202185955138</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202190036520.png\" alt=\"image-20231202190036520\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202190036520</figcaption></figure>\n<h1 id=\"三、测试\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#三、测试\"><span>三、测试</span></a></h1>\n<ul>\n<li>启动消费者端</li>\n<li>发送消息，但是路由键不对，于是转入备份交换机</li>\n</ul>\n</template>","contentStripped":"<h2 id=\"_1、创建备份交换机\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1、创建备份交换机\"><span>1、创建备份交换机</span></a></h2>\n<p><span style=\"color:blue;font-weight:bolder;\">注意</span>：备份交换机<span style=\"color:blue;font-weight:bolder;\">一定</span>要选择<span style=\"color:blue;font-weight:bolder;\">fanout类型</span>，因为原交换机转入备份交换机时并不会指定路由键</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231203231926247.png\" alt=\"image-20231203231926247\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231203231926247</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202183701454.png\" alt=\"image-20231202183701454\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202183701454</figcaption></figure>\n<h2 id=\"_2、创建备份交换机要绑定的队列\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2、创建备份交换机要绑定的队列\"><span>2、创建备份交换机要绑定的队列</span></a></h2>\n<h3 id=\"_1创建队列\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1创建队列\"><span>①创建队列</span></a></h3>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202183906676.png\" alt=\"image-20231202183906676\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202183906676</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202183949674.png\" alt=\"image-20231202183949674\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202183949674</figcaption></figure>\n<h3 id=\"_2绑定交换机\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2绑定交换机\"><span>②绑定交换机</span></a></h3>\n<p><span style=\"color:blue;font-weight:bolder;\">注意</span>：这里是要和备份交换机绑定</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231203232801504.png\" alt=\"image-20231203232801504\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231203232801504</figcaption></figure>\n<h2 id=\"_3、针对备份队列创建消费端监听器\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3、针对备份队列创建消费端监听器\"><span>3、针对备份队列创建消费端监听器</span></a></h2>\n<div class=\"language-java line-numbers-mode\" data-ext=\"java\" data-title=\"java\"><button class=\"copy\" title=\"复制代码\" data-copied=\"已复制\"></button><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> final</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> String</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> EXCHANGE_DIRECT_BACKUP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exchange.direct.order.backup</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> final</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> String</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> QUEUE_NAME_BACKUP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">queue.order.backup</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    @</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">RabbitListener</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">bindings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> @</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">QueueBinding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">            value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> @</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">Queue</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> QUEUE_NAME_BACKUP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> durable</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">true</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">            exchange</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> @</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">Exchange</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EXCHANGE_DIRECT_BACKUP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">            key</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    ))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> processMessageBackup</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">String dateString</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                                     Message message</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                                     Channel channel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        log</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">info</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">BackUp: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> dateString</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span></code></pre>\n\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h1 id=\"二、设定备份关系\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#二、设定备份关系\"><span>二、设定备份关系</span></a></h1>\n<h2 id=\"_1、原交换机删除\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1、原交换机删除\"><span>1、原交换机删除</span></a></h2>\n<p>·</p>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202184840124.png\" alt=\"image-20231202184840124\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202184840124</figcaption></figure>\n<h2 id=\"_2、重新创建原交换机\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2、重新创建原交换机\"><span>2、重新创建原交换机</span></a></h2>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202185211633.png\" alt=\"image-20231202185211633\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202185211633</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202185342087.png\" alt=\"image-20231202185342087\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202185342087</figcaption></figure>\n<h2 id=\"_3、原交换机重新绑定原队列\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3、原交换机重新绑定原队列\"><span>3、原交换机重新绑定原队列</span></a></h2>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202190111581.png\" alt=\"image-20231202190111581\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202190111581</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202185955138.png\" alt=\"image-20231202185955138\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202185955138</figcaption></figure>\n<figure><img src=\"@source/notes/MQ/RabbitMQ/assets/image-20231202190036520.png\" alt=\"image-20231202190036520\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20231202190036520</figcaption></figure>\n<h1 id=\"三、测试\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#三、测试\"><span>三、测试</span></a></h1>\n<ul>\n<li>启动消费者端</li>\n<li>发送消息，但是路由键不对，于是转入备份交换机</li>\n</ul>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"\n## 1、创建备份交换机\n\n<span style=\"color:blue;font-weight:bolder;\">注意</span>：备份交换机<span style=\"color:blue;font-weight:bolder;\">一定</span>要选择<span style=\"color:blue;font-weight:bolder;\">fanout类型</span>，因为原交换机转入备份交换机时并不会指定路由键\n\n![image-20231203231926247](./assets/image-20231203231926247.png)\n\n\n\n![image-20231202183701454](./assets/image-20231202183701454.png)\n\n\n\n## 2、创建备份交换机要绑定的队列\n\n### ①创建队列\n\n![image-20231202183906676](./assets/image-20231202183906676.png)\n\n\n\n\n\n![image-20231202183949674](./assets/image-20231202183949674.png)\n\n\n\n### ②绑定交换机\n\n<span style=\"color:blue;font-weight:bolder;\">注意</span>：这里是要和备份交换机绑定\n\n![image-20231203232801504](./assets/image-20231203232801504.png)\n\n\n\n## 3、针对备份队列创建消费端监听器\n\n```java\n    public static final String EXCHANGE_DIRECT_BACKUP = \"exchange.direct.order.backup\";\n    public static final String QUEUE_NAME_BACKUP  = \"queue.order.backup\";\n\n    @RabbitListener(bindings = @QueueBinding(\n            value = @Queue(value = QUEUE_NAME_BACKUP, durable = \"true\"),\n            exchange = @Exchange(value = EXCHANGE_DIRECT_BACKUP),\n            key = {\"\"}\n    ))\n    public void processMessageBackup(String dateString,\n                                     Message message,\n                                     Channel channel) {\n        log.info(\"BackUp: \" + dateString);\n    }\n```\n\n\n\n# 二、设定备份关系\n\n## 1、原交换机删除\n\n·\n\n![image-20231202184840124](./assets/image-20231202184840124.png)\n\n\n\n## 2、重新创建原交换机\n\n![image-20231202185211633](./assets/image-20231202185211633.png)\n\n\n\n![image-20231202185342087](./assets/image-20231202185342087.png)\n\n\n\n## 3、原交换机重新绑定原队列\n\n![image-20231202190111581](./assets/image-20231202190111581.png)\n\n\n\n![image-20231202185955138](./assets/image-20231202185955138.png)\n\n\n\n![image-20231202190036520](./assets/image-20231202190036520.png)\n\n\n\n# 三、测试\n\n- 启动消费者端\n- 发送消息，但是路由键不对，于是转入备份交换机","excerpt":"","includedFiles":[],"tasklists":0,"title":"二、设定备份关系","headers":[{"level":2,"title":"1、创建备份交换机","slug":"_1、创建备份交换机","link":"#_1、创建备份交换机","children":[]},{"level":2,"title":"2、创建备份交换机要绑定的队列","slug":"_2、创建备份交换机要绑定的队列","link":"#_2、创建备份交换机要绑定的队列","children":[{"level":3,"title":"①创建队列","slug":"_1创建队列","link":"#_1创建队列","children":[]},{"level":3,"title":"②绑定交换机","slug":"_2绑定交换机","link":"#_2绑定交换机","children":[]}]},{"level":2,"title":"3、针对备份队列创建消费端监听器","slug":"_3、针对备份队列创建消费端监听器","link":"#_3、针对备份队列创建消费端监听器","children":[]},{"level":2,"title":"1、原交换机删除","slug":"_1、原交换机删除","link":"#_1、原交换机删除","children":[]},{"level":2,"title":"2、重新创建原交换机","slug":"_2、重新创建原交换机","link":"#_2、重新创建原交换机","children":[]},{"level":2,"title":"3、原交换机重新绑定原队列","slug":"_3、原交换机重新绑定原队列","link":"#_3、原交换机重新绑定原队列","children":[]}]}}
